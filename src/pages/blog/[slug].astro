---
import { getCollection } from "astro:content";
import Layout from "../../layouts/Layout.astro";

export async function getStaticPaths() {
  const posts = await getCollection("blog", ({ data }) => !data.draft);

  return posts.map((post) => ({
    params: { slug: post.slug },
    props: { post },
  }));
}

const { post } = Astro.props;
const { Content } = await post.render();
---

<Layout title={`${post.data.title} — Blog`}>
  <main class="page" id="main-content">
    <header class="hero">
      <a href="/" class="home-btn">
        <span aria-hidden="true">←</span>
        Return
      </a>
      <p class="eyebrow">Blog</p>
      <h1>{post.data.title}</h1>
      <div class="meta">
        <span class="pill">
          {
            post.data.publishDate.toLocaleDateString("vi-VN", {
              year: "numeric",
              month: "short",
              day: "2-digit",
            })
          }
        </span>
        {
          post.data.tags.length ? (
            <div class="tags">
              {post.data.tags.map((tag) => (
                <a
                  class="tag"
                  href={`/blog?tag=${encodeURIComponent(tag)}`}
                >
                  {tag}
                </a>
              ))}
            </div>
          ) : null
        }
      </div>
      {
        post.data.description ? (
          <p class="lead">{post.data.description}</p>
        ) : null
      }
    </header>

    <article class="content">
      <Content />
    </article>
  </main>
</Layout>

<style>
  .page {
    padding: 5rem 1.5rem 6rem;
    max-width: 820px;
    margin: 0 auto;
    display: flex;
    flex-direction: column;
    gap: 2rem;
  }

  .hero {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
  }

  .home-btn {
    display: inline-flex;
    align-items: center;
    gap: 0.35rem;
    color: var(--ctp-subtext0);
    text-decoration: none;
    transition: color 0.2s ease;
    width: fit-content;
    margin-bottom: 0.25rem;
    font-size: 0.85rem;
    font-weight: 400;
  }

  .home-btn:hover {
    color: var(--ctp-lavender);
  }

  .eyebrow {
    color: var(--ctp-mauve);
    font-weight: 700;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    font-size: 0.85rem;
  }

  h1 {
    font-size: 2.2rem;
    color: var(--ctp-text);
    line-height: 1.25;
  }

  .meta {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    flex-wrap: wrap;
    color: var(--ctp-subtext0);
  }

  .pill {
    padding: 0.35rem 0.85rem;
    border-radius: 999px;
    background-color: var(--ctp-surface0);
    border: 1px solid var(--ctp-surface1);
  }

  .tags {
    display: inline-flex;
    gap: 0.35rem;
    flex-wrap: wrap;
  }

  .tag {
    padding: 0.25rem 0.65rem;
    border-radius: 999px;
    border: 1px solid var(--ctp-pink);
    color: var(--ctp-pink);
    background-color: rgba(245, 194, 231, 0.08);
    font-size: 0.9rem;
  }

  .lead {
    color: var(--ctp-subtext0);
    max-width: 680px;
  }

  .content {
    background-color: var(--ctp-surface0);
    border: 1px solid var(--ctp-surface1);
    border-radius: 18px;
    padding: 2rem;
    box-shadow: 0 12px 32px rgba(0, 0, 0, 0.22);
    line-height: 1.7;
  }

  .content :global(p) {
    margin: 1rem 0;
    color: var(--ctp-subtext0);
  }

  .content :global(h2),
  .content :global(h3),
  .content :global(h4) {
    margin: 1.5rem 0 0.6rem;
    color: var(--ctp-text);
  }

  .content :global(ul),
  .content :global(ol) {
    margin: 1rem 0 1rem 1.25rem;
    color: var(--ctp-subtext0);
    display: grid;
    gap: 0.35rem;
  }

  .content :global(code) {
    background-color: var(--ctp-surface1);
    padding: 0.15rem 0.4rem;
    border-radius: 6px;
    color: var(--ctp-peach);
  }

  .content :global(pre) {
    background-color: var(--ctp-surface1);
    color: var(--ctp-text);
    padding: 1rem;
    border-radius: 12px;
    overflow-x: auto;
  }

  .content :global(a) {
    color: var(--ctp-sky);
  }

  @media (max-width: 640px) {
    .page {
      padding: 4rem 1.25rem 5rem;
    }

    h1 {
      font-size: 1.8rem;
    }

    .content {
      padding: 1.5rem;
    }
  }
</style>
